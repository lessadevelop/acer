

////////////////////////////

	    MYSQL - install

////////////////////////////



atualizando

		sudo apt-get update


instalando server e client


		sudo apt-get install mysql-server mysql-client
		
		
administrando

		sudo service mysql status
		sudo service mysql start
		sudo service mysql stop
		sudo service mysql restart
		

arquivo de configuração no 5.5

		/etc/mysql/my.cnf						    vim my.cnf
              		
		

arquivo de configuração no 8.x


		/etc/mysql/mysql.conf.d/mysqld.cnf          vim mysqld.cnf
		
		
alterar ou incluir senha no root


		sudo mysqladmin -u root -p password
		
digita senha atual

new senha

acessar como root

		mysql -u root -p
		
ele pede a senha




pode entao ocorrer um erro:

		ERROR 1698 (28000): Access denied for user 'root'@'localhost'
		
como resolvi

		entrando como sudo do linux
		criando um usuario na tabela mysql.user com mesmo nome do meu usuario do linux
		assim não preciso alterar o plugin, que no mysql 8 é do tipo  'caching_sha2_password'
		
		
			entrar como sudo
			
					sudo mysql -u root -p 
					
					
			selecionando o banco mysql
			
					mysql> USE mysql; 																	// não esqueça o ponto-virgula (;) 
					
					
			criando meu usario
			
					mysql> CREATE USER 'YOUR_SYSTEM_USER'@'localhost' IDENTIFIED BY 'YOUR_PASSWD';    	// TEM QUE USAR ASPAS
			
			
			gravando os privilegios para o usuario		
					
					mysql> GRANT ALL PRIVILEGES ON *.* TO 'YOUR_SYSTEM_USER'@'localhost';
					
					
			ESSE PASSO NÃO VAI PRECISAR PORQUE USEI UM USUARIO DO PROPRIO LINUX
			
					mysql> UPDATE user SET plugin='auth_socket' WHERE User='YOUR_SYSTEM_USER';
					
			atualizando os privilegios:
			
					mysql> FLUSH PRIVILEGES;
					
			saindo
					mysql> exit;
					
			reiniciando o mysql-server
			
					sudo service mysql restart

--------------------------------------------------------------
IDENTIFICANDO PROBLEMA -  o root esta com plugin auth socket 
--------------------------------------------------------------
				
						
		it means that: db_users using it, will be "authenticated" by the system user credentials. 
		You can see if your root user is set up like this by doing the following:
		
		sudo mysql -u root # I had to use "sudo" since it was a new installation
		
		mysql> USE mysql;
		mysql> SELECT User, Host, plugin FROM mysql.user;
		
		+------------------+-----------------------+
		| User             | plugin                |
		+------------------+-----------------------+
		| root             | auth_socket           |  <--- olha ai o problema... so consegue entrar como sudo
		| mysql.sys        | mysql_native_password |
		| debian-sys-maint | mysql_native_password |
		+------------------+-----------------------+
		
		As you can see in the query, the root user is using the auth_socket plugin.
		
		There are two ways to solve this:
		
    		You can set the root user to use the mysql_native_password plugin
    		You can create a new db_user with you system_user (recommended)
    				
    				
----------------------------------------------------------------
SOLUÇÃO 1 - trocar plugin auth socket por mysql_native_password
----------------------------------------------------------------
				
		Option 1:  set the root user to use the mysql_native_password plugin
				
				
				
				sudo mysql -u root # I had to use "sudo" since it was a new installation
				
				mysql> USE mysql;
				mysql> UPDATE user SET plugin='mysql_native_password' WHERE User='root';
				mysql> FLUSH PRIVILEGES;
				mysql> exit;
				
				sudo service mysql restart
							
--------------------------------------------------------------
SOLUÇÃO 2 - criar novo usuario - RECOMENDADO
--------------------------------------------------------------


		Option 2: (replace YOUR_SYSTEM_USER with the username you have)
				
				sudo mysql -u root # I had to use "sudo" since it was a new installation
				
				mysql> USE mysql;
				mysql> CREATE USER 'YOUR_SYSTEM_USER'@'localhost' IDENTIFIED BY 'YOUR_PASSWD';    tem que usar as aspas
				mysql> GRANT ALL PRIVILEGES ON *.* TO 'YOUR_SYSTEM_USER'@'localhost';
				mysql> UPDATE user SET plugin='auth_socket' WHERE User='YOUR_SYSTEM_USER';
				mysql> FLUSH PRIVILEGES;
				mysql> exit;
				
				sudo service mysql restart
				
				Remember that if you use option #2 you'll have to connect to MySQL 
				as your system username (mysql -u YOUR_SYSTEM_USER).
				
				Note: On some systems (e.g., Debian 9 (Stretch)) the 'auth_socket' 
				plugin is called 'unix_socket', so the corresponding SQL command 
				should be: UPDATE user SET plugin='unix_socket' WHERE User='YOUR_SYSTEM_USER';
				
				From andy's comment it seems that MySQL 8.x.x updated/replaced the 
				auth_socket for caching_sha2_password. I don't have a system setup 
				with MySQL 8.x.x to test this. However, the steps above should help 
				you to understand the issue. Here's the reply:
				
				One change as of MySQL 8.0.4 is that the new default authentication 
				plugin is 'caching_sha2_password'. The new 'YOUR_SYSTEM_USER' will 
				have this authentication plugin and you can log in from the Bash 
				shell now with "mysql -u YOUR_SYSTEM_USER -p" and provide the 
				password for this user on the prompt. There isn’t any need 
				for the "UPDATE user SET plugin" step.
				

--------------------------------------------------------------
SOLUÇÃO 3 - excluir o plugin do root na tabela user
--------------------------------------------------------------
				
						
				
    				Autentique-se como administrador no servidor de banco de dados:
				
				
    						mysql -u root
				
    				e acesse o ‘mysql’:
				
				
    						use mysql
    						
				
    				Faça a seguinte edição:
				
				
    						update mysql.user set plugin='' where User='root';
    						
    						
				
    				Por fim, “refresque” o cache e saia do servidor:
				
				
    						flush privileges;
    						exit
				
		


